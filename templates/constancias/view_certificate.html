{% extends "base.html" %}
{% load static %}

{% block title %}Ver Constancia - BENUNE{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'certificate_list' %}">Constancias</a></li>
                    <li class="breadcrumb-item active">Ver</li>
                </ol>
            </nav>
            
            <h1 class="h2 text-primary-custom">Constancia de Estudios</h1>
            <p class="lead">Detalles de la constancia generada</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary-custom text-white">
                    <h3 class="h5 mb-0">Información de la Constancia</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Alumno</h6>
                            <p class="fw-bold">{{ constancia.alumno.nombre_completo }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Matrícula</h6>
                            <p class="fw-bold">{{ constancia.alumno.matricula }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Carrera</h6>
                            <p class="fw-bold">{{ constancia.alumno.carrera.nombre|default:"No asignada" }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Semestre</h6>
                            <p class="fw-bold">{{ constancia.alumno.semestre_actual }}° Semestre</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Fecha de Emisión</h6>
                            <p class="fw-bold">{{ constancia.fecha_emision }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Estado</h6>
                            <span class="badge {% if constancia.estado == 'generada' %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ constancia.get_estado_display }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-secondary-custom text-white">
                    <h3 class="h5 mb-0">Acciones</h3>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        {% if constancia.archivo_pdf %}
                        <a href="{% url 'download_certificate' constancia.id %}" class="btn btn-primary-custom btn-lg">
                            <i class="fas fa-download me-2"></i>Descargar PDF
                        </a>
                        {% else %}
                        <button class="btn btn-secondary btn-lg" disabled>
                            <i class="fas fa-exclamation-triangle me-2"></i>PDF No Disponible
                        </button>
                        {% endif %}
                        <a href="{% url 'certificate_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Volver a la Lista
                        </a>
                        <a href="{% url 'generate_certificate' %}" class="btn btn-outline-primary-custom">
                            <i class="fas fa-plus me-2"></i>Generar Nueva
                        </a>
                    </div>
                </div>
            </div>
            
            {% if not constancia.archivo_pdf %}
            <div class="alert alert-warning mt-3">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Advertencia:</strong> El archivo PDF no está disponible. 
                Puede que haya ocurrido un error durante la generación.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Vista previa de la constancia -->
    <div class="card mt-4">
        <div class="card-header bg-light">
            <h3 class="h5 mb-0">Vista Previa de la Constancia</h3>
        </div>
        <div class="card-body">
            <div class="constancia-preview border p-4 bg-white">
                <div class="text-center mb-4">
                    <h2 class="text-primary-custom fw-bold">BENEMÉRITA ESCUELA NORMAL URBANA NOCTURNA DEL ESTADO</h2>
                    <h3 class="text-secondary-custom">"ING. JOSÉ G. VALENZUELA"</h3>
                    <p class="mb-0 text-muted">Clave: 02ENL0004Y</p>
                </div>
                
                <div class="text-center mb-4">
                    <h4 class="text-dark fw-bold border-bottom pb-2 d-inline-block">CONSTANCIA DE ESTUDIOS</h4>
                </div>
                
                <div class="constancia-content">
                    <p class="text-justify">
                        Quien suscribe Dr(a). Liuba Abiyova Téllez Osuna Directora de la BENEMÉRITA
                        ESCUELA NORMAL URBANA NOCTURNA DEL ESTADO. ING. JOSÉ G. VALENZUELA
                        con clave <strong>02ENL0004Y</strong>, hace constar que según documentos que se
                        encuentran en los archivos de esta Institución el (la) C. 
                        <strong class="text-primary">{{ constancia.alumno.nombre_completo }}</strong> 
                        con número de matrícula <strong>{{ constancia.alumno.matricula }}</strong>
                        y CURP: <strong>{{ constancia.alumno.curp }}</strong>,
                        es alumno(a) regular y se encuentra inscrito(a) en el 
                        <strong>{{ constancia.alumno.semestre_actual }}°</strong> semestre turno 
                        <strong>{{ constancia.alumno.get_turno_display }}</strong> de la
                        <strong>{{ constancia.alumno.carrera.nombre|default:"Carrera no asignada" }}</strong>
                        plan de estudios <strong>{{ constancia.alumno.plan }}</strong>.
                    </p>
                    
                    <p class="text-justify">
                        Se otorga la presente constancia para los fines legales que a la parte interesada
                        convengan en la Ciudad de Mexicali, Baja California, México, a los 
                        <strong>{{ constancia.fecha_emision.day }}</strong> días del mes de 
                        {% with month=constancia.fecha_emision.month %}
                            {% if month == 1 %}Enero{% elif month == 2 %}Febrero{% elif month == 3 %}Marzo{% elif month == 4 %}Abril{% elif month == 5 %}Mayo{% elif month == 6 %}Junio{% elif month == 7 %}Julio{% elif month == 8 %}Agosto{% elif month == 9 %}Septiembre{% elif month == 10 %}Octubre{% elif month == 11 %}Noviembre{% elif month == 12 %}Diciembre{% endif %}
                        {% endwith %} 
                        del <strong>{{ constancia.fecha_emision.year }}</strong>.
                    </p>
                </div>
                
                <div class="row mt-5">
                    <div class="col-md-6 text-center">
                        <div class="signature-line mx-auto mb-2" style="border-top: 1px solid #000; width: 200px;"></div>
                        <p class="fw-bold mb-1">Vo.Bo. Subdirección Académica</p>
                        <p class="text-muted small">BENUNE</p>
                    </div>
                    <div class="col-md-6 text-center">
                        <div class="signature-line mx-auto mb-2" style="border-top: 1px solid #000; width: 200px;"></div>
                        <p class="fw-bold mb-1">Dr(a). Liuba Abiyova Téllez Osuna</p>
                        <p class="text-muted small">Directora de BENUNE</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.constancia-preview {
    background-color: #f8f9fa;
    font-family: 'Times New Roman', serif;
    line-height: 1.6;
    min-height: 400px;
}

.signature-line {
    border-top: 1px solid #000;
    width: 200px;
    margin: 0 auto;
}

.card {
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: none;
}

.card-header {
    border-radius: 10px 10px 0 0 !important;
}

.btn-lg {
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
}
</style>
{% endblock %}